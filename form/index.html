---
layout: default
title: Submit Your OSM GeoWeek Event!!
---

<style>
    body { margin: 0; padding: 0; }
    html, body, #map { height: 100%; }

</style>
<link rel="stylesheet" href="./form.css"/>

<!-- <link rel="stylesheet" href="{{ site.baseurl }}/lib/leaflet/leaflet.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.9/leaflet.draw.css" />

<script src="{{ site.baseurl }}/lib/leaflet/leaflet-src.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.9/leaflet.draw.js"></script> -->
<link rel='stylesheet' href='https://unpkg.com/maplibre-gl@3.3.0/dist/maplibre-gl.css' />
<script src='https://unpkg.com/maplibre-gl@3.3.0/dist/maplibre-gl.js'></script>

<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.0/mapbox-gl-draw.css" type="text/css">
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.2/mapbox-gl-draw.js"></script>

<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
<script src='https://www.google.com/recaptcha/api.js'></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">

<!--https://github.com/marioizquierdo/jquery.serializeJSON-->
<script type="text/javascript" src="{{ site.baseurl }}/lib/jquery.serializejson.js"></script>

<!--turf.min.js-->
<!-- <script src="{{ site.baseurl }}/lib/turf/turf_ThuAug022018.min.js" charset="utf-8"></script> -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- The bootstrap libraries are already included in the default_bootstrap layout, don't add them again to prevent Uncaught TypeErrors -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">



<!-- Load the `maplibre-gl-geocoder` plugin. -->
<script src="https://unpkg.com/@maplibre/maplibre-gl-geocoder@1.2.0/dist/maplibre-gl-geocoder.min.js"></script>
<link
    rel="stylesheet"
    href="https://unpkg.com/@maplibre/maplibre-gl-geocoder@1.2.0/dist/maplibre-gl-geocoder.css"
    type="text/css"
/>


<script type='text/javascript'>


$(document).ready(function(){

  console.log('inside document ready4x');


  $('#sandbox-container input').datepicker({
      autoclose: true
  });

  $('#sandbox-container input').on('show', function(e){
      console.debug('show', e.date, $(this).data('stickyDate'));
      if ( e.date ) {
           $(this).data('stickyDate', e.date);
      }
      else {
           $(this).data('stickyDate', null);
      }
  });

  $('#sandbox-container input').on('hide', function(e){
      console.debug('hide', e.date, $(this).data('stickyDate'));
      var stickyDate = $(this).data('stickyDate');

      if ( !e.date && stickyDate ) {
          console.debug('restore stickyDate', stickyDate);
          $(this).datepicker('setDate', stickyDate);
          $(this).data('stickyDate', null);
      }
  });
  $("[data-toggle='tooltip']").tooltip();
});

  function validateForm() {

    console.log("inside validateForm");
    
    var name = document.forms["myForm"]["name"].value;
    var location = document.forms["myForm"]["location"].value;
    var email = document.forms["myForm"]["email"].value;
    var date = document.forms["myForm"]["date"].value;

    if (name == "") {
      alert("Name must be filled out");
      return false;
    } else if (location == "") {
      alert("location must be filled out");
      return false;
    } else if (email == "") {
      alert("Email must be filled out");
      return false;
    } else if (date == "") {
      alert("date must be filled out");
      return false;
    } else {
      return true;
    }

  }

</script>



<div class="limiter">

    <div class="row">
        <div class="col-md-12">
            <header role="header">
              <h1 class="page-title">{{ page.title }}</h1>
            </header>
        </div>
    </div>

<div class="row">

<div class="col-md-12">

<br>

<section>
    <!-- <div id="map" style="margin-left: auto; margin-right: auto; width: 100%; height: 400px"></div> -->
  <form name="myForm" id="form" >
    
    
      <div class="form-group c85 " data-cid="c85">
        <!-- <label class="control-label group-title" for="c85" style="margin-top:15px;">Submit Your OSM GeoWeek Event!</label> -->
        <div>PRIVACY NOTICE
            The data you provide on this form will be processed for the purpose of registering and publicizing an OSM GeoWeek event. By completing this form, you consent to us using your information for this purpose. The event information will be shared on the <a href=https://osmgeoweek.org/>osmgeoweek.org</a> and other communication channels like Twitter and Facebook. 
            
            Your event data is publicly accessible. We retain a complete list of events. If you wish to remove your submitted data from our databases, or amend any details, please contact us. 
        </div>
      </div>
      
      

      <div class="form-group c1 required" data-cid="c1">
        <label class="control-label group-title" for="c85" style="margin-top:15px;">What is the name of your event?</label>
        <!-- <label class="control-label" for="c1">What is the name of your event?</label> -->

        <input type="text" class="form-control" id="name" name="name" value=""     />

      </div>

      <div class="form-group c53 required" data-cid="c53">
        <label class="control-label group-title" for="c85" style="margin-top:15px;">Country</label>
        <br>
        <label class="" for="c53">What country will you be in?</label>

        <select class="form-control" id="country" name="country"   
            >
          <option  value="AF">Afghanistan</option>
          <option  value="AX">Åland Islands</option>
          <option  value="AL">Albania</option>
          <option  value="DZ">Algeria</option>
          <option  value="AS">American Samoa</option>
          <option  value="AD">Andorra</option>
          <option  value="AO">Angola</option>
          <option  value="AI">Anguilla</option>
          <option  value="AQ">Antarctica</option>
          <option  value="AG">Antigua and Barbuda</option>
          <option  value="AR">Argentina</option>
          <option  value="AM">Armenia</option>
          <option  value="AW">Aruba</option>
          <option  value="AU">Australia</option>
          <option  value="AT">Austria</option>
          <option  value="AZ">Azerbaijan</option>
          <option  value="BS">Bahamas</option>
          <option  value="BH">Bahrain</option>
          <option  value="BD">Bangladesh</option>
          <option  value="BB">Barbados</option>
          <option  value="BY">Belarus</option>
          <option  value="BE">Belgium</option>
          <option  value="BZ">Belize</option>
          <option  value="BJ">Benin</option>
          <option  value="BM">Bermuda</option>
          <option  value="BT">Bhutan</option>
          <option  value="BO">Bolivia</option>
          <option  value="BA">Bosnia and Herzegovina</option>
          <option  value="BW">Botswana</option>
          <option  value="BV">Bouvet Island</option>
          <option  value="BR">Brazil</option>
          <option  value="IO">British Indian Ocean Territory</option>
          <option  value="BN">Brunei Darussalam</option>
          <option  value="BG">Bulgaria</option>
          <option  value="BF">Burkina Faso</option>
          <option  value="BI">Burundi</option>
          <option  value="KH">Cambodia</option>
          <option  value="CM">Cameroon</option>
          <option  value="CA">Canada</option>
          <option  value="CV">Cape Verde</option>
          <option  value="KY">Cayman Islands</option>
          <option  value="CF">Central African Republic</option>
          <option  value="TD">Chad</option>
          <option  value="CL">Chile</option>
          <option  value="CN">China</option>
          <option  value="CX">Christmas Island</option>
          <option  value="CC">Cocos (Keeling) Islands</option>
          <option  value="CO">Colombia</option>
          <option  value="KM">Comoros</option>
          <option  value="CG">Congo</option>
          <option  value="CD">Congo, The Democratic Republic of the</option>
          <option  value="CK">Cook Islands</option>
          <option  value="CR">Costa Rica</option>
          <option  value="CI">Cote D"Ivoire</option>
          <option  value="HR">Croatia</option>
          <option  value="CU">Cuba</option>
          <option  value="CY">Cyprus</option>
          <option  value="CZ">Czech Republic</option>
          <option  value="DK">Denmark</option>
          <option  value="DJ">Djibouti</option>
          <option  value="DM">Dominica</option>
          <option  value="DO">Dominican Republic</option>
          <option  value="EC">Ecuador</option>
          <option  value="EG">Egypt</option>
          <option  value="SV">El Salvador</option>
          <option  value="GQ">Equatorial Guinea</option>
          <option  value="ER">Eritrea</option>
          <option  value="EE">Estonia</option>
          <option  value="ET">Ethiopia</option>
          <option  value="FK">Falkland Islands (Malvinas)</option>
          <option  value="FO">Faroe Islands</option>
          <option  value="FJ">Fiji</option>
          <option  value="FI">Finland</option>
          <option  value="FR">France</option>
          <option  value="GF">French Guiana</option>
          <option  value="PF">French Polynesia</option>
          <option  value="TF">French Southern Territories</option>
          <option  value="GA">Gabon</option>
          <option  value="GM">Gambia</option>
          <option  value="GE">Georgia</option>
          <option  value="DE">Germany</option>
          <option  value="GH">Ghana</option>
          <option  value="GI">Gibraltar</option>
          <option  value="GR">Greece</option>
          <option  value="GL">Greenland</option>
          <option  value="GD">Grenada</option>
          <option  value="GP">Guadeloupe</option>
          <option  value="GU">Guam</option>
          <option  value="GT">Guatemala</option>
          <option  value="GG">Guernsey</option>
          <option  value="GN">Guinea</option>
          <option  value="GW">Guinea-Bissau</option>
          <option  value="GY">Guyana</option>
          <option  value="HT">Haiti</option>
          <option  value="HM">Heard Island and Mcdonald Islands</option>
          <option  value="VA">Holy See (Vatican City State)</option>
          <option  value="HN">Honduras</option>
          <option  value="HK">Hong Kong</option>
          <option  value="HU">Hungary</option>
          <option  value="IS">Iceland</option>
          <option  value="IN">India</option>
          <option  value="ID">Indonesia</option>
          <option  value="IR">Iran, Islamic Republic Of</option>
          <option  value="IQ">Iraq</option>
          <option  value="IE">Ireland</option>
          <option  value="IM">Isle of Man</option>
          <option  value="IL">Israel</option>
          <option  value="IT">Italy</option>
          <option  value="JM">Jamaica</option>
          <option  value="JP">Japan</option>
          <option  value="JE">Jersey</option>
          <option  value="JO">Jordan</option>
          <option  value="KZ">Kazakhstan</option>
          <option  value="KE">Kenya</option>
          <option  value="KI">Kiribati</option>
          <option  value="KP">Democratic People"s Republic of Korea</option>
          <option  value="KR">Korea, Republic of</option>
          <option  value="XK">Kosovo</option>
          <option  value="KW">Kuwait</option>
          <option  value="KG">Kyrgyzstan</option>
          <option  value="LA">Lao People"s Democratic Republic</option>
          <option  value="LV">Latvia</option>
          <option  value="LB">Lebanon</option>
          <option  value="LS">Lesotho</option>
          <option  value="LR">Liberia</option>
          <option  value="LY">Libyan Arab Jamahiriya</option>
          <option  value="LI">Liechtenstein</option>
          <option  value="LT">Lithuania</option>
          <option  value="LU">Luxembourg</option>
          <option  value="MO">Macao</option>
          <option  value="MK">Macedonia, The Former Yugoslav Republic of</option>
          <option  value="MG">Madagascar</option>
          <option  value="MW">Malawi</option>
          <option  value="MY">Malaysia</option>
          <option  value="MV">Maldives</option>
          <option  value="ML">Mali</option>
          <option  value="MT">Malta</option>
          <option  value="MH">Marshall Islands</option>
          <option  value="MQ">Martinique</option>
          <option  value="MR">Mauritania</option>
          <option  value="MU">Mauritius</option>
          <option  value="YT">Mayotte</option>
          <option  value="MX">Mexico</option>
          <option  value="FM">Micronesia, Federated States of</option>
          <option  value="MD">Moldova, Republic of</option>
          <option  value="MC">Monaco</option>
          <option  value="MN">Mongolia</option>
          <option  value="ME">Montenegro</option>
          <option  value="MS">Montserrat</option>
          <option  value="MA">Morocco</option>
          <option  value="MZ">Mozambique</option>
          <option  value="MM">Myanmar</option>
          <option  value="NA">Namibia</option>
          <option  value="NR">Nauru</option>
          <option  value="NP">Nepal</option>
          <option  value="NL">Netherlands</option>
          <option  value="AN">Netherlands Antilles</option>
          <option  value="NC">New Caledonia</option>
          <option  value="NZ">New Zealand</option>
          <option  value="NI">Nicaragua</option>
          <option  value="NE">Niger</option>
          <option  value="NG">Nigeria</option>
          <option  value="NU">Niue</option>
          <option  value="NF">Norfolk Island</option>
          <option  value="MP">Northern Mariana Islands</option>
          <option  value="NO">Norway</option>
          <option  value="OM">Oman</option>
          <option  value="PK">Pakistan</option>
          <option  value="PW">Palau</option>
          <option  value="PS">Palestinian Territory, Occupied</option>
          <option  value="PA">Panama</option>
          <option  value="PG">Papua New Guinea</option>
          <option  value="PY">Paraguay</option>
          <option  value="PE">Peru</option>
          <option  value="PH">Philippines</option>
          <option  value="PN">Pitcairn</option>
          <option  value="PL">Poland</option>
          <option  value="PT">Portugal</option>
          <option  value="PR">Puerto Rico</option>
          <option  value="QA">Qatar</option>
          <option  value="RE">Reunion</option>
          <option  value="RO">Romania</option>
          <option  value="RU">Russian Federation</option>
          <option  value="RW">Rwanda</option>
          <option  value="SH">Saint Helena</option>
          <option  value="KN">Saint Kitts and Nevis</option>
          <option  value="LC">Saint Lucia</option>
          <option  value="PM">Saint Pierre and Miquelon</option>
          <option  value="VC">Saint Vincent and the Grenadines</option>
          <option  value="WS">Samoa</option>
          <option  value="SM">San Marino</option>
          <option  value="ST">Sao Tome and Principe</option>
          <option  value="SA">Saudi Arabia</option>
          <option  value="SN">Senegal</option>
          <option  value="RS">Serbia</option>
          <option  value="SC">Seychelles</option>
          <option  value="SL">Sierra Leone</option>
          <option  value="SG">Singapore</option>
          <option  value="SK">Slovakia</option>
          <option  value="SI">Slovenia</option>
          <option  value="SB">Solomon Islands</option>
          <option  value="SO">Somalia</option>
          <option  value="ZA">South Africa</option>
          <option  value="GS">South Georgia and the South Sandwich Islands</option>
          <option  value="ES">Spain</option>
          <option  value="LK">Sri Lanka</option>
          <option  value="SD">Sudan</option>
          <option  value="SR">Suriname</option>
          <option  value="SJ">Svalbard and Jan Mayen</option>
          <option  value="SZ">Swaziland</option>
          <option  value="SE">Sweden</option>
          <option  value="CH">Switzerland</option>
          <option  value="SY">Syrian Arab Republic</option>
          <option  value="TW">Taiwan</option>
          <option  value="TJ">Tajikistan</option>
          <option  value="TZ">Tanzania, United Republic of</option>
          <option  value="TH">Thailand</option>
          <option  value="TL">Timor-Leste</option>
          <option  value="TG">Togo</option>
          <option  value="TK">Tokelau</option>
          <option  value="TO">Tonga</option>
          <option  value="TT">Trinidad and Tobago</option>
          <option  value="TN">Tunisia</option>
          <option  value="TR">Turkey</option>
          <option  value="TM">Turkmenistan</option>
          <option  value="TC">Turks and Caicos Islands</option>
          <option  value="TV">Tuvalu</option>
          <option  value="UG">Uganda</option>
          <option  value="UA">Ukraine</option>
          <option  value="AE">United Arab Emirates</option>
          <option  value="GB">United Kingdom</option>
          <option  value="US">United States</option>
          <option  value="UM">United States Minor Outlying Islands</option>
          <option  value="UY">Uruguay</option>
          <option  value="UZ">Uzbekistan</option>
          <option  value="VU">Vanuatu</option>
          <option  value="VE">Venezuela</option>
          <option  value="VN">Viet Nam</option>
          <option  value="VG">Virgin Islands, British</option>
          <option  value="VI">Virgin Islands, U.S.</option>
          <option  value="WF">Wallis and Futuna</option>
          <option  value="EH">Western Sahara</option>
          <option  value="YE">Yemen</option>
          <option  value="ZM">Zambia</option>
          <option  value="ZW">Zimbabwe</option>
          
          </select>
          
        </div>

        <div class="form-group c58 required" data-cid="c58">
            <label class="control-label group-title" for="c85" style="margin-top:15px;">Where will your event be held?
            </label>
            <br>
        <label class="" for="c58">This could be a venue and/or city where the organizers are based. If this is a fully virtual event, please write “virtual”.</label>
        <input type="text" class="form-control" id="location" name="location" value=""     />
        </div>
        
        <div class="form-group c58 required" data-cid="c58">
            <label class="control-label group-title" for="c85" style="margin-top:15px;">Draw a point on the map. (Click on the marker icon and then on the map)
            </label>
        </div>
        <label id="geocode-result"></label>
        <div id="map" style="margin-left: auto; margin-right: auto; width: 100%; height: 400px"></div>
  
        <div class="form-group c58 required" data-cid="c58">
        <!-- <label class="control-label" for="c58">You must input using the following format: YYYY-MM-DD (For example, 2020-01-18)</label> -->
        <label class="control-label group-title" for="c85" style="margin-top:15px;">What date is your event taking place?

        </label>
        <div class="form-group">
            <div class='input-group date' id='sandbox-container'>
              
              <input type="text" class="form-control" id="date" name="date"/>

              <span class="input-group-addon">
                  <span class="glyphicon glyphicon-calendar"></span>
              </span>
            </div>
          </div>
        </div>

        <div class="form-group c2 " data-cid="c2">
            <label class="control-label group-title" for="c85" style="margin-top:15px;">Please insert a link where people can sign up
            </label>
            <br>
            <label class="" for="c2">A link where people can go to sign up (Eventbrite, Meetup, Facebook etc). URLs need to start with "http://" or "https://"</label>

            <input type="text" class="form-control" id="link" name="link" value=""     />
            
        </div>

        <div class="form-group c2 " data-cid="c2">
            <label class="control-label group-title" for="c2">What organization is behind the event? (school, club, etc)</label>

            <input type="text" class="form-control" id="org" name="org" value=""     />
            
        </div>

        <div class="form-group c2 " data-cid="c2">
            <label class="control-label group-title" for="c2">If your event will use specific tracking hashtags (OpenStreetMap changeset comments), what are they?</label>

            <input type="text" class="form-control" id="hashtags" name="hashtags" value=""     />
            
        </div>

        <div class="form-group c2 " data-cid="c2">
            <label class="control-label group-title" for="c85" style="margin-top:15px;">Name of the contact / person for the event?
            </label>
            <br>
            <label class="" for="c2">This will not display publicly on the site.</label>

            <input type="text" class="form-control" id="contact" name="contact" value=""     />
        </div>

        <div class="form-group c2 required" data-cid="c2">
            <label class="control-label group-title" for="c85" style="margin-top:15px;">Email address of the contact person?
            </label>
            <br>
            <label class="" for="c2">This will not display publicly on the site. We may contact you if we have any questions about your posting, to connect you with interested mappers, or to email you about future OSMGeoWeek related events.</label>

            <div class="input-group"><span class="input-group-addon left"><i class="glyphicon glyphicon-envelope"></i> </span>
            <input type="email" class="form-control" id="email" name="email" value=""   
                data-rule-email="true" 
                data-rule-required="true"  />
            </div>
            
        </div>


    <br>
    <!--Google Captcha-->
    <div class="g-recaptcha" data-sitekey="6Ld6Y_EnAAAAAER7WM8vo2xe8bCzDLlapYHkL6U2"></div>

    <br>

    <div>
    <input type="submit" class="btn btn-primary btn-lg" style="z-index: 1;" value="Submit" />
        <span id="loadingDiv" style="vertical-align: sub">
            <i class="fa fa-circle-o-notch fa-spin" style="font-size:24px"></i> Submitting form...
        </span>
    </div>

</form>

<div class="container jf-thankyou" style="display:none;" data-redirect="" data-seconds="10">
  <h3>Your form has been submitted. Thank You!</h3>
</div>

<div class="container jf-error" style="display:none;" data-redirect="" data-seconds="10">
  <h3>Error in submitting form, please e-mail us at <a href="mailto:info@teachosm.org ">info@teachosm.org</a></h3>
</div>

</section>

<br>
<br>

</div>

</div>
</div>


<script>
    var $loading = $('#loadingDiv').hide();

    var data_geojson;
    /* eslint-disable camelcase */
    const map = new maplibregl.Map({
        container: 'map',
        // Use a minimalist raster style
        style: {
            'version': 8,
            'name': 'Blank',
            'center': [0, 0],
            'zoom': 0,
            'sources': {
                'raster-tiles': {
                    'type': 'raster',
                    'tiles': ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'],
                    'tileSize': 256,
                    'minzoom': 0,
                    'maxzoom': 18
                }
            },
            'layers': [
                {
                    'id': 'background',
                    'type': 'background',
                    'paint': {
                        'background-color': '#e0dfdf'
                    }
                },
                {
                    'id': 'simple-tiles',
                    'type': 'raster',
                    'source': 'raster-tiles'
                }
            ],
            'id': 'blank'
        },
        center: [0, 20],
        zoom: 1,
        pitch: 15,
        bearing: 0,
        antialias: true
    });

    //temp fix: https://github.com/maplibre/maplibre-gl-js/issues/2601
    MapboxDraw.constants.classes.CONTROL_BASE = "maplibregl-ctrl";
    MapboxDraw.constants.classes.CONTROL_PREFIX = "maplibregl-ctrl-";
    MapboxDraw.constants.classes.CONTROL_GROUP = "maplibregl-ctrl-group";

    // Add controls for drawing
    const draw = new MapboxDraw({
        displayControlsDefault: false,
        controls: {
            point: true,
            polygon: false,
            line_string: false,
            trash: true
        },
    styles: [
        // Style for the drawn point
        {
            "id": "gl-draw-point",
            "type": "circle",
            "filter": ["all", ["==", "$type", "Point"], ["!=", "mode", "static"]],
            "paint": {
                "circle-radius": 7,
                "circle-color": "#D20C0C", // Red color
                "circle-stroke-width": 2,
                "circle-stroke-color": "#ffffff" // White outline
            }
        },
        // ... You can also add styles for lines, polygons, etc.
    ]
    });

    map.addControl(draw, 'top-left');

    map.on('draw.create', function(event) {
    const data = event.features[0];
    console.log("Feature drawn:", data);
    });

    map.on('draw.delete', function(event) {
        console.log("Feature deleted");
    });

    map.on('draw.update', function(event) {
        console.log("Feature updated");
    });

    // Listen for the draw.create event
    map.on('draw.create', async function (event) {
    const geometry = event.features[0].geometry;
    if (geometry.type === 'Point') {
        const [lng, lat] = geometry.coordinates;
        try {
            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
            const data = await response.json();
            console.log('print data');
            console.log(data);
            var marker = L.marker([data.lat, data.lon]);
            data_geojson = marker.toGeoJSON();
            console.log('print data_geojson');
            console.log(data_geojson);
            if (data && data.display_name) {
                // Update the content of the div with the reverse geocoded result
                document.getElementById('geocode-result').textContent = `Location: ${data.display_name}`;
            } else {
                document.getElementById('geocode-result').textContent = 'Unable to reverse geocode the location.';
            }
        } catch (error) {
            console.error('Error reverse geocoding:', error);
            document.getElementById('geocode-result').textContent = 'Error occurred while reverse geocoding.';
        }
    }
});

// Assuming you've already initialized your map as 'map'
const navControl = new maplibregl.NavigationControl({ showCompass: false });
map.addControl(navControl, 'top-right');  // 'top-left' is the default position


//debugging
window.addEventListener("beforeunload", function(event) {
    event.preventDefault();
    event.returnValue = 'Are you sure you want to leave?';
});

$(document)
  .ajaxStart(function () {
    $loading.show();
  })
  .ajaxStop(function () {
    $loading.hide();
  });

// Variable to hold request
var request;

// Bind to the submit event of our form
$("#form").submit(function(event){
    // Prevent the form from submitting
    event.preventDefault();
    
    console.log('submit button pressed');

    // Abort any pending request
    if (request) {
    request.abort();
    }

    if ( validateForm() ) {
      // when its true
    } else {
      // when its false exit submit
      console.log('form validation failed');
      event.preventDefault();
      return false;
    }

    // setup some local variables
    var $form = $(this);

    // Let's select and cache all the fields
    var $inputs = $form.find("input, select, button, textarea");

    // Serialize the data in the form
    var serializedData = $form.serialize();
    //event.preventDefault();
    //var serializedData = $('input[name!=geojson]', this).serialize(); 

    // Log the serialized data to the console
    console.log("Serialized Data:", serializedData);

    console.log('g-recaptcha');
    var recaptchaVar = $("#g-recaptcha-response").val();
    console.log(recaptchaVar);

    formJSON = $('form').serializeJSON();
    //console.log('print form JSON data');
    //console.log(formJSON);

    function submitForm_w_geojson(uploaded_file) {
      
      // Let's disable the inputs for the duration of the Ajax request.
      // Note: we disable elements AFTER the form data has been serialized.
      // Disabled form elements will not be serialized.
      $inputs.prop("disabled", true);

      console.log('data_geojson data: ');
      console.log(data_geojson);
      //console.log(JSON.stringify(json));

      //http://stackoverflow.com/questions/11110880/save-anonymous-github-gist-with-jquery-ajax

      if (uploaded_file){
          var data = {
            "description": "uploaded_geojson",
            "public": true,
            "files": uploaded_file
          }
      } else {
            //if geojson area drawn
            var data = {
            "description": "user_created_geojson",
            "public": true,
            "files": JSON.stringify(data_geojson),
            "recaptcha": recaptchaVar
          }
      }

      var newJSON = $.extend({}, data, formJSON);
      console.log('print newJSON');
      console.log(newJSON);


      //https://script.google.com/macros/s/AKfycbwm4LAjzXInUnRe2zSC5bIVWGqfBRZy1yj-__GqPM3TjCpwJnyg8nBCp5vMO8gNi2KV/exec
      //instead of post request as an anynomous gist, it is posted on AWS
      $.ajax({
        //url: 'https://yujbp2w1q9.execute-api.us-east-1.amazonaws.com/dev/forms',
        url: '{{ site.api }}',
        type: 'POST',
        //contentType: 'application/json',
        dataType: 'json',
        data: JSON.stringify(newJSON)
      })
      .done( function(e) {
        console.log('done, display result: e');
        console.log(e);
        // Check if the server indicates a successful operation
        if (e.success) {
            $(".jf-thankyou").show();
        } else {
            console.error("Server responded, but indicated an error:", e.message);
        }
      })
      .fail(function(jqXHR, textStatus, errorThrown) {
        console.error("Request failed: " + textStatus);
        console.error("Error thrown: " + errorThrown);
        console.error(jqXHR);
  });

    //     request = $.ajax({
    //         url: "https://script.google.com/macros/s/AKfycbyZ7grQaH1ixo-qfB9su3l1YJQPf4_MdxlK9LTP3bDs7yQYzx2r/exec",
    //         type: "post",
    //         data: serializedData + '&geojson=' + JSON.stringify(json) + '&geojson_id=' + e.Id,
    //     });
            
    //     // Callback handler that will be called on success
    //     request.done(function (response, textStatus, jqXHR){
    //         // Log a message to the console
    //         //console.log("Hooray, it worked!");
    //         $(".jf-thankyou").show();
    //         //console.log("drawn json: ");
    //         //console.log(json);
    //     });

    //     // Callback handler that will be called on failure
    //     request.fail(function (jqXHR, textStatus, errorThrown){
    //         // Log the error to the console
    //         console.error(
    //             "The following error occurred: "+
    //             textStatus, errorThrown
    //         );
    //         $(".jf-error").show();
    //     });

    //     // Callback handler that will be called regardless
    //     // if the request failed or succeeded
    //     request.always(function () {
    //     // Reenable the inputs
    //     $inputs.prop("disabled", false);
    //     });
    //   })
    //   .fail( function(e) {
    //     console.warn("gist save error", e);
    //     $(".jf-error").show();
    //   });

    }

    if (data_geojson){
        console.log("geojson drawn");
        submitForm_w_geojson();
      } else {
        //console.log("only DG ID provided");
        console.log("form would be submitted")
        //submitForm();
      }

    // Prevent default posting of form
    // event.preventDefault();

});


</script>






